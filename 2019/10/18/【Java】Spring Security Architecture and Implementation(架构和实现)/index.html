<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Spring Security Architecture and Implementation(架构和实现)关于spring-security的官网文档学习笔记,主要是第8章 Architecture and Implementation(架构和实现)内容 参考: https:&#x2F;&#x2F;docs.spring.io&#x2F;spring-security&#x2F;site&#x2F;docs&#x2F;5.2.1.BUILD-SNAPSH">
<meta property="og:type" content="article">
<meta property="og:title" content="【Java】Spring Security Architecture and Implementation(架构和实现)">
<meta property="og:url" content="http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/index.html">
<meta property="og:site_name" content="Melody">
<meta property="og:description" content="Spring Security Architecture and Implementation(架构和实现)关于spring-security的官网文档学习笔记,主要是第8章 Architecture and Implementation(架构和实现)内容 参考: https:&#x2F;&#x2F;docs.spring.io&#x2F;spring-security&#x2F;site&#x2F;docs&#x2F;5.2.1.BUILD-SNAPSH">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/security-interception.png">
<meta property="og:image" content="http://example.com/images/authentication.png">
<meta property="article:published_time" content="2019-10-18T00:00:00.000Z">
<meta property="article:modified_time" content="2023-05-23T23:02:03.518Z">
<meta property="article:author" content="Xin Chen">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/security-interception.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>【Java】Spring Security Architecture and Implementation(架构和实现)</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" "Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/melodyfff">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post " href="/2019/10/24/%E3%80%90Java%E3%80%91JUC%20-%20CompletionService%20Executor%E4%B8%8EBlockingQueue/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post " href="/2019/09/25/%E3%80%90openshift%E3%80%91OC%E5%91%BD%E4%BB%A4%E9%83%A8%E7%BD%B2Openshift/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top " href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post " href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&text=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&title=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&is_video=false&description=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=【Java】Spring Security Architecture and Implementation(架构和实现)&body=Check out this article: http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&title=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&title=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&title=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&title=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&name=【Java】Spring Security Architecture and Implementation(架构和实现)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&t=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Security-Architecture-and-Implementation-%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.</span> <span class="toc-text">Spring Security Architecture and Implementation(架构和实现)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Architecture-and-Implementation-%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.1.</span> <span class="toc-text">Architecture and Implementation(架构与实现)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary-%E6%91%98%E8%A6%81"><span class="toc-number">1.1.1.</span> <span class="toc-text">Summary(摘要)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Authentication-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">1.1.2.</span> <span class="toc-text">Authentication(身份验证)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#What-is-authentication-in-Spring-Security"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">What is authentication in Spring Security?</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Authentication-in-a-Web-Application"><span class="toc-number">1.1.3.</span> <span class="toc-text">Authentication in a Web Application</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ExceptionTranslationFilter"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">ExceptionTranslationFilter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AuthenticationEntryPoint"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">AuthenticationEntryPoint</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Authentication-Mechanism"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">Authentication Mechanism</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Storing-the-SecurityContext-between-requests"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">Storing the SecurityContext between requests</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Access-Control-Authorization-in-Spring-Security"><span class="toc-number">1.1.4.</span> <span class="toc-text">Access-Control (Authorization) in Spring Security</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Security-and-AOP-Advice"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">Security and AOP Advice</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Secure-Objects-and-the-AbstractSecurityInterceptor"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">Secure Objects and the AbstractSecurityInterceptor</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#What-are-Configuration-Attributes-%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">1.1.4.2.1.</span> <span class="toc-text">What are Configuration Attributes(配置属性)?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RunAsManager"><span class="toc-number">1.1.4.2.2.</span> <span class="toc-text">RunAsManager</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AfterInvocationManager"><span class="toc-number">1.1.4.2.3.</span> <span class="toc-text">AfterInvocationManager</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Extending-the-Secure-Object-Model"><span class="toc-number">1.1.4.2.4.</span> <span class="toc-text">Extending the Secure Object Model</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Core-Services-%E6%A0%B8%E5%BF%83%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.1.5.</span> <span class="toc-text">Core Services(核心服务)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AuthenticationManager%EF%BC%8CProviderManager%E5%92%8CAuthenticationProvider"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">AuthenticationManager，ProviderManager和AuthenticationProvider</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Erasing-Credentials-on-Successful-Authentication"><span class="toc-number">1.1.5.1.1.</span> <span class="toc-text">Erasing Credentials on Successful Authentication</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DaoAuthenticationProvider"><span class="toc-number">1.1.5.1.2.</span> <span class="toc-text">DaoAuthenticationProvider</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDetailsService-Implementations"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">UserDetailsService Implementations</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#In-Memory-Authentication"><span class="toc-number">1.1.5.2.1.</span> <span class="toc-text">In-Memory Authentication</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JdbcDaoImpl"><span class="toc-number">1.1.5.2.2.</span> <span class="toc-text">JdbcDaoImpl</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Authority-Groups"><span class="toc-number">1.1.5.2.3.</span> <span class="toc-text">Authority Groups</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        【Java】Spring Security Architecture and Implementation(架构和实现)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Xin Chen</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-10-18T00:00:00.000Z" itemprop="datePublished">2019-10-18</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/java/" rel="tag">java</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="Spring-Security-Architecture-and-Implementation-架构和实现"><a href="#Spring-Security-Architecture-and-Implementation-架构和实现" class="headerlink" title="Spring Security Architecture and Implementation(架构和实现)"></a>Spring Security Architecture and Implementation(架构和实现)</h1><p>关于<code>spring-security</code>的官网文档学习笔记,主要是<code>第8章 Architecture and Implementation(架构和实现)</code>内容</p>
<p>参考: <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.2.1.BUILD-SNAPSHOT/reference/htmlsingle/#overall-architecture">https://docs.spring.io/spring-security/site/docs/5.2.1.BUILD-SNAPSHOT/reference/htmlsingle/#overall-architecture</a></p>
<h2 id="Architecture-and-Implementation-架构与实现"><a href="#Architecture-and-Implementation-架构与实现" class="headerlink" title="Architecture and Implementation(架构与实现)"></a>Architecture and Implementation(架构与实现)</h2><p>应用程序安全性可以归结为或多或少的两个独立问题：身份验证（您是谁）和授权（您可以做什么？）</p>
<hr>
<h3 id="Summary-摘要"><a href="#Summary-摘要" class="headerlink" title="Summary(摘要)"></a>Summary(摘要)</h3><p><code>Spring Security</code>的主要组成部分:</p>
<ul>
<li><code>SecurityContextHolder</code>，提供对的访问<code>SecurityContext</code>。</li>
<li><code>SecurityContext</code>，以保存<code>Authentication</code>（可能还有特定于请求的）安全信息。</li>
<li><code>Authentication</code>，以特定于<code>Spring Security</code>的方式表示主体。</li>
<li><code>GrantedAuthority</code>，以反映授予主体的应用程序范围的权限。</li>
<li><code>UserDetails</code>，以提供必要的信息以从应用程序的DAO或其他安全数据源构建<code>Authentication</code>对象。</li>
<li><code>UserDetailsService</code>，以<code>UserDetails</code>在传入String基于-的用户名（或证书ID等）时创建一个。</li>
</ul>
<hr>
<h3 id="Authentication-身份验证"><a href="#Authentication-身份验证" class="headerlink" title="Authentication(身份验证)"></a>Authentication(身份验证)</h3><h4 id="What-is-authentication-in-Spring-Security"><a href="#What-is-authentication-in-Spring-Security" class="headerlink" title="What is authentication in Spring Security?"></a>What is authentication in Spring Security?</h4><p><code>Spring Security</code>中的身份验证:</p>
<ul>
<li>获取用户名和密码，并将其组合到的一个实例<code>UsernamePasswordAuthenticationToken</code>（<code>Authentication</code>接口的实例）。</li>
<li>令牌会传递到的实例<code>AuthenticationManager</code>进行验证。</li>
<li>成功认证后 ，<code>AuthenticationManager</code>返回一个完全填充的<code>Authentication</code>实例。</li>
<li>通过调用<code>SecurityContextHolder.getContext().setAuthentication(…​)</code>并传入返回的身份验证对象来建立安全上下文。</li>
</ul>
<p><strong>官网实例:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 身份认证实例</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> AuthenticationManager&#125; 认证管理器,处理&#123;<span class="doctag">@link</span> Authentication&#125;请求,返回一个完全填充的&#123;<span class="doctag">@link</span> Authentication&#125;实例</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> GrantedAuthority&#125; 授予的权限</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 参考: https://docs.spring.io/spring-security/site/docs/5.2.1.BUILD-SNAPSHOT/reference/htmlsingle/#tech-intro-authentication</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xinchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 16/10/2019 11:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthenticationExample</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AuthenticationManager am = <span class="keyword">new</span> SampleAuthenticationManager();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        BufferedReader in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;Please enter your username:&quot;</span>);</span><br><span class="line">            String name = in.readLine();</span><br><span class="line">            System.out.println(<span class="string">&quot;Please enter your password:&quot;</span>);</span><br><span class="line">            String password = in.readLine();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Authentication request = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(name, password);</span><br><span class="line">                Authentication result = am.authenticate(request);</span><br><span class="line">                SecurityContextHolder.getContext().setAuthentication(result);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span>(AuthenticationException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Authentication failed: &quot;</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Successfully authenticated. Security context contains: &quot;</span> +</span><br><span class="line">                SecurityContextHolder.getContext().getAuthentication());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleAuthenticationManager</span> <span class="keyword">implements</span> <span class="title">AuthenticationManager</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> List&lt;GrantedAuthority&gt; AUTHORITIES = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// 初始化角色</span></span><br><span class="line">        AUTHORITIES.add(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">&quot;ROLE_USER&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="comment">// authentication.getCredentials() 通常是密码</span></span><br><span class="line">        <span class="keyword">if</span> (authentication.getName().equals(authentication.getCredentials()))&#123;</span><br><span class="line">            <span class="comment">// Object principal, Object credentials, Collection&lt;? extends GrantedAuthority&gt; authorities</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> UsernamePasswordAuthenticationToken(authentication.getName(), authentication.getCredentials(), AUTHORITIES);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> BadCredentialsException(<span class="string">&quot;Bad Credentials&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Authentication-in-a-Web-Application"><a href="#Authentication-in-a-Web-Application" class="headerlink" title="Authentication in a Web Application"></a>Authentication in a Web Application</h3><p>考虑典型的<code>Web</code>应用程序的身份验证过程：</p>
<ul>
<li>1.您访问主页，然后单击链接。</li>
<li>2.请求发送到服务器，服务器确定您已请求受保护的资源。</li>
<li>3.由于您目前尚未通过身份验证，因此服务器会发回响应，指示您必须进行身份验证。响应将是HTTP响应代码，或重定向到特定网页。</li>
<li>4.根据身份验证机制，您的浏览器将重定向到特定网页，以便您可以填写表格，或者浏览器将以某种方式检索您的身份（通过BASIC身份验证对话框，cookie，X.509证书等）。 ）。</li>
<li>5.浏览器将响应发送回服务器。这将是包含您填写的表单内容的HTTP POST或包含身份验证详细信息的HTTP标头。</li>
<li>6.接下来，服务器将决定所提供的凭据是否有效。如果有效，则将进行下一步。如果它们无效，通常会要求您的浏览器再试一次（因此您返回到上面的第二步）。</li>
<li>7.您尝试引起身份验证过程的原始请求将被重试。希望您已获得足够授权的身份验证，以访问受保护的资源。如果您具有足够的访问权限，则请求将成功。否则，您将收到一个HTTP错误代码403，表示“禁止”。</li>
</ul>
<p><code>Spring Security</code>具有负责上述大多数步骤的不同类。<br>主要参与者（按照使用顺序）是<code>ExceptionTranslationFilter</code>，<code>AuthenticationEntryPoint</code>和和<code>“Authentication Mechanism(身份验证机制)”</code>，它们负责调用<code>AuthenticationManager</code></p>
<h4 id="ExceptionTranslationFilter"><a href="#ExceptionTranslationFilter" class="headerlink" title="ExceptionTranslationFilter"></a>ExceptionTranslationFilter</h4><p><code>ExceptionTranslationFilter</code>是一个Spring Security过滤器，它负责检测抛出的任何Spring Security异常(<code>AccessDeniedException</code>和<code>AuthenticationException</code>).<br>此类异常通常由<code>AbstractSecurityInterceptor</code>授权服务的主要提供者抛出</p>
<h4 id="AuthenticationEntryPoint"><a href="#AuthenticationEntryPoint" class="headerlink" title="AuthenticationEntryPoint"></a>AuthenticationEntryPoint</h4><p><code>AuthenticationEntryPoint(认证入口点)</code>主要负责上述步骤中的第<code>3</code>步.<br>主要是在<code>ExceptionTranslationFilter</code>中通过捕获到<code>AuthenticationException</code>异常后,<br>调用<code>handleSpringSecurityException(...)</code>在此方法中的<code>sendStartAuthentication(...)</code>开启认证方案</p>
<h4 id="Authentication-Mechanism"><a href="#Authentication-Mechanism" class="headerlink" title="Authentication Mechanism"></a>Authentication Mechanism</h4><p><code>Authentication Mechanism(身份验证机制)</code>,<br>一旦您的浏览器提交了身份验证凭据(authentication credentials)（作为HTTP表单帖子或HTTP标头<br>,服务器上就需要有一些东西来“收集”这些身份验证详细信息。到目前为止，我们位于上述列表的第<code>6</code>步.<br>在<code>Spring Security</code>中，我们有一个特殊的名称，用于从用户代理（通常是Web浏览器）收集身份验证详细信息的功能，将其称为<code>Authentication Mechanism(身份验证机制)</code>。<br>从用户代理收集到身份验证详细信息后，<code>Authentication</code>便会构建一个<code>“请求”</code>对象，然后将其呈现给<code>AuthenticationManager</code></p>
<p><code>Authentication Mechanism(身份验证机制)</code>收到完整的<code>Authentication(从AuthenticationManager中返回)</code>对象后，<br>它将认为请求有效，将<code>Authentication</code>放入<code>SecurityContextHolder</code>，<br>并导致重试原始请求（上述步骤<code>7</code>）。<br>另一方面，如果<code>AuthenticationManager</code>拒绝了请求，<br>则认证机制将要求用户代理重试（上面的第<code>2</code>步）。</p>
<p>通常<code>AuthenticationManager</code>中的返回:</p>
<ul>
<li>如果它可以验证输入是否代表有效的主体，则返回<code>Authentication</code>（通常为<code>authenticated=true</code>）</li>
<li>如果它认为输入代表无效的主体，则抛出一个<code>AuthenticationException</code></li>
<li>如果无法决定，则返回 <code>null</code></li>
</ul>
<h4 id="Storing-the-SecurityContext-between-requests"><a href="#Storing-the-SecurityContext-between-requests" class="headerlink" title="Storing the SecurityContext between requests"></a>Storing the SecurityContext between requests</h4><p>在请求之间如何存储<code>SecurityContext</code>?根据应用程序的类型，可能需要制定一种策略来存储用户操作之间的安全上下文。在典型的Web应用程序中，用户登录一次，然后通过其会话ID(<code>session id</code>)进行标识。<br>有效期取决于服务器<code>session</code>的过期时间.</p>
<p>在<code>Spring Security</code>中，存储<code>SecurityContext</code>请求之间的责任落在<code>SecurityContextPersistenceFilter</code>，<br>默认情况下，将上下文存储为<code>HttpSession</code>HTTP请求之间的属性(将设置<code>request.setAttribute(FILTER_APPLIED, Boolean.TRUE);</code>保证值执行一次)。<br>它将上下文<code>SecurityContextHolder</code>还原到每个请求，并且至关重要的是，当请求完成时清除<code>SecurityContextHolder</code></p>
<p><code>SecurityContextPersistenceFilter</code>中真正存储由<code>SecurityContextRepository</code>完成,通过调用<code>loadContext(...)加载</code>其中:</p>
<ul>
<li><code>NullSecurityContextRepository</code>实际上是每次都生成新的<code>SecurityContextHolder.createEmptyContext()</code></li>
<li><code>HttpSessionSecurityContextRepository</code>实际上是存储在<code>HttpSession</code>中,默认属性值为<code>SPRING_SECURITY_CONTEXT</code>,可以通过修改<code>springSecurityContextKey</code>自定义该值</li>
</ul>
<p>许多其他类型的应用程序（例如，无状态RESTful Web服务）不使用HTTP会话，并且将在每个请求上重新进行身份验证。<br>但是，仍然必须确保链中包含<code>SecurityContextPersistenceFilter</code>，以确保<code>SecurityContextHolder</code>在每次请求后清除。</p>
<hr>
<h3 id="Access-Control-Authorization-in-Spring-Security"><a href="#Access-Control-Authorization-in-Spring-Security" class="headerlink" title="Access-Control (Authorization) in Spring Security"></a>Access-Control (Authorization) in Spring Security</h3><p>在<code>Spring Security</code>中负责做出访问控制决策的主要接口是<code>AccessDecisionManager</code>。它具有一种<code>decide</code>方法，该方法采用<code>Authentication</code>代表请求访问的主体的对象，<code>“secure object(安全对象)”</code>（请参见下文）以及适用于该对象的安全元数据属性列表（例如授予访问权限所需的角色列表） ）。</p>
<h4 id="Security-and-AOP-Advice"><a href="#Security-and-AOP-Advice" class="headerlink" title="Security and AOP Advice"></a>Security and AOP Advice</h4><p>您可以选择使用<code>AspectJ</code>或<code>Spring AOP</code>执行方法授权，也可以选择使用过滤器执行Web请求授权,<code>Spring Security</code>中主要是<code>AbstractSecurityInterceptor</code>的继承类<code>FilterSecurityInterceptor</code>贯穿整个周期</p>
<h4 id="Secure-Objects-and-the-AbstractSecurityInterceptor"><a href="#Secure-Objects-and-the-AbstractSecurityInterceptor" class="headerlink" title="Secure Objects and the AbstractSecurityInterceptor"></a>Secure Objects and the AbstractSecurityInterceptor</h4><p>那么，什么是 <code>“secure object(安全对象)”</code>？<code>Spring Security</code>使用该术语来指代任何可以对其应用安全性（例如授权决策）的对象。最常见的示例是方法调用和Web请求。</p>
<p>每个受支持的安全对象类型都有其自己的拦截器类(<code>AbstractSecurityInterceptor</code>的子类),<br>重要的是,当<code>AbstractSecurityInterceptor</code>被调用时,如果<code>principal(主体)</code>已通过身份验证，<br><code>SecurityContextHolder</code>则将包含有效<code>Authentication</code>的内容。</p>
<p><code>AbstractSecurityInterceptor</code> 提供用于处理安全对象请求的一致工作流，通常是：</p>
<ul>
<li>1.查找与当前请求关联的<code>“configuration attributes(配置属性)”</code></li>
<li>2.将安全对象，当前<code>Authentication</code>属性和配置属性提交<code>AccessDecisionManager</code>给授权决策</li>
<li>3.（可选）更改<code>Authentication</code>调用的依据</li>
<li>4.允许进行安全对象调用（假设已授予访问权限）</li>
<li>5.调用返回后如果配置了<code>AfterInvocationManager</code>,则调用。一旦调用引发了异常，<code>AfterInvocationManager</code>则不会调用。</li>
</ul>
<blockquote>
<p>注,关于步骤<code>2</code>,可查看<code>AbstractSecurityInterceptor</code>中的<code>this.accessDecisionManager.decide(authenticated, object, attributes);</code></p>
</blockquote>
<h5 id="What-are-Configuration-Attributes-配置属性"><a href="#What-are-Configuration-Attributes-配置属性" class="headerlink" title="What are Configuration Attributes(配置属性)?"></a>What are Configuration Attributes(配置属性)?</h5><p>可以将<code>“configuration attribute(配置属性)”</code>视为一个<code>String</code>，它对所有<code>AbstractSecurityInterceptor</code>使用的类具有特殊的含义.<br>它们由框架内的接口<code>ConfigAttribute</code>表示。它们可以是简单的角色名称，也可以具有更复杂的含义，具体取决于<code>AccessDecisionManager</code>的具体实现。<br><code>AbstractSecurityInterceptor</code>配置了<code>SecurityMetadataSource</code>来查找安全对象的属性。通常，此配置将对用户隐藏。<br>配置属性将作为安全方法的注释或安全URL的访问属性输入.<br>例如，当我们配置<code>&lt;intercept-url pattern=&#39;/secure/**&#39; access=&#39;ROLE_A,ROLE_B&#39;/&gt;</code>，这表示配置属性<code>ROLE_A</code>和<code>ROLE_B</code>适用于与给定模式匹配的网络请求。<br>实际上，使用默认<code>AccessDecisionManager</code>配置,这意味着<code>GrantedAuthority</code>将允许具有这两个属性之一匹配的任何人访问。<br>严格来说，它们只是属性，其解释取决于<code>AccessDecisionManager</code>的实现。<br>前缀的使用<code>ROLE_</code>是一个标记，以指示这些属性是角色，并且应由<code>Spring Security</code>的<code>RoleVoter</code>消费.<br>这仅<code>AccessDecisionManager</code>在使用基于投票者的情况下才有意义。</p>
<h5 id="RunAsManager"><a href="#RunAsManager" class="headerlink" title="RunAsManager"></a>RunAsManager</h5><p>假设<code>AccessDecisionManager</code>决定允许该请求,<code>AbstractSecurityInterceptor</code>通常将继续进行该请求。<br>但是有可能用户希望用不同的<code>Authentication</code>替换处于<code>SecurityContext</code>中已经通过<code>AccessDecisionManager</code>处理返回的<code>Authentication</code>,这个时候可以使用<code>RunAsManager</code>.<br>当服务层方法(Service layer)需要调用远程系统并显示不同的标识(不同的安全属性等)时,这可能会有有用.<br>因为<code>Spring Security</code>会自动将安全身份从一台服务器传播到另一台服务器（假设您使用的是正确配置的<code>RMI</code>或<code>HttpInvoker</code>远程协议客户端）</p>
<h5 id="AfterInvocationManager"><a href="#AfterInvocationManager" class="headerlink" title="AfterInvocationManager"></a>AfterInvocationManager</h5><p>当安全对象(secure object)调用和返回,这可能意味着方法调用完成或过滤器链继续进行,<code>AbstractSecurityInterceptor</code>最终有机会处理该调用。<br>在这个阶段,<code>AbstractSecurityInterceptor</code>可以修改返回对象.<br>我们可能希望发生这种情况，因为无法在安全对象调用的“途中”做出授权决定。<br>由于高度可插拔，因此<code>AbstractSecurityInterceptor</code>将控制权传递给<code>AfterInvocationManager</code>以便在需要时实际修改对象。<br>此类甚至可以完全替换对象，或者引发异常，也可以按照其选择的任何方式对其进行更改。<br>调用后检查仅在调用成功的情况下执行。如果发生异常，将跳过其他检查。</p>
<p><strong>Security interceptors and the “secure object” model</strong><br><img src="/images/security-interception.png"></p>
<h5 id="Extending-the-Secure-Object-Model"><a href="#Extending-the-Secure-Object-Model" class="headerlink" title="Extending the Secure Object Model"></a>Extending the Secure Object Model</h5><p>只有打算采用全新的拦截和授权请求方式的开发人员才需要直接使用安全对象。<br>例如，有可能建立一个新的安全对象以保护对消息系统的呼叫。<br>任何需要安全性并且还提供拦截呼叫的方式的东西（例如，围绕建议语义的AOP）都可以成为安全对象。<br>话虽如此，大多数Spring应用程序将完全透明地使用当前支持的三种安全对象类型（AOP Alliance <code>MethodInvocation</code>，AspectJ <code>JoinPoint</code>和Web request <code>FilterInvocation</code>）。</p>
<hr>
<h3 id="Core-Services-核心服务"><a href="#Core-Services-核心服务" class="headerlink" title="Core Services(核心服务)"></a>Core Services(核心服务)</h3><p>现在，我们对<code>Spring Security</code>的架构和核心类的高度概括，让我们来仔细看看一个或两个核心接口及其实现的，<br>特别是<code>AuthenticationManager</code>，<code>UserDetailsService</code>和<code>AccessDecisionManager</code>。</p>
<h4 id="AuthenticationManager，ProviderManager和AuthenticationProvider"><a href="#AuthenticationManager，ProviderManager和AuthenticationProvider" class="headerlink" title="AuthenticationManager，ProviderManager和AuthenticationProvider"></a>AuthenticationManager，ProviderManager和AuthenticationProvider</h4><p><img src="/images/authentication.png"><br><code>AuthenticationManager</code>只是一个接口，这样实现可以让我们选择，但它是如何在实践中运作？<br>如果我们需要检查多个身份验证数据库或不同身份验证服务（例如数据库和LDAP服务器）的组合，该怎么办？</p>
<p><code>Spring Security</code>中的默认实现是<code>ProviderManager</code>,而不是处理身份验证请求本身,<br>它委托给已配置的<code>AuthenticationProviders</code>列表，依次查询每个，以查看其是否可以执行身份验证。<br>每个provider都会引发异常或者返回一个完全填充的<code>Authentication</code>对象.<br>验证身份验证请求的最常见方法是加载相应<code>UserDetails</code>的密码，并对照用户输入的密码检查已加载的密码。<br>这是<code>DaoAuthenticationProvider</code>（见下文）使用的方法。加载的<code>UserDetails</code>对象-尤其是<code>GrantedAuthority</code>包含的对象-<br>当成功认证时,会构建一个完全填充的<code>Authentication</code>对象返回,并且存储到<code>SecurityContext</code>环境上下文中.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;authenticationManager&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.security.authentication.ProviderManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--     这些bean都是AuthenticationProvider的实现类    --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">local</span>=<span class="string">&quot;daoAuthenticationProvider&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">local</span>=<span class="string">&quot;anonymousAuthenticationProvider&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">local</span>=<span class="string">&quot;ldapAuthenticationProvider&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在上面的示例中，我们有三个提供程序。它们按照所示的顺序进行尝试.<br>每个提供程序都可以尝试进行身份验证，也可以通过简单地返回来跳过身份验证<code>null</code>。<br>如果所有实现均返回<code>null</code>，<code>ProviderManager</code>则将抛出<code>ProviderNotFoundException</code>。</p>
<p>诸如Web表单登录处理过滤器之类的身份验证机制,其注入了对<code>ProviderManager</code>的引用,并将调用它来处理其身份验证请求。<br>你需要的providers有时候可能会被认证机制(authentication mechanisms)调用,而其他时候,它们将取决于特定的身份验证机制(a specific authentication mechanism)。<br>例如，<code>DaoAuthenticationProvider</code>和<code>LdapAuthenticationProvider</code>与提交简单的用户名/密码身份验证请求的任何机制都兼容,因此,通常和基于表单的登录认证或HTTP Basic身份验证一起使用.<br>另一方面，某些身份验证机制会创建一个身份验证请求对象，该对象只能由一种类型的<code>AuthenticationProvider</code>。<br>一个示例就是<code>JA-SIG CAS</code>，它使用服务票证的概念，因此只能由进行身份验证<code>CasAuthenticationProvider</code>。</p>
<h5 id="Erasing-Credentials-on-Successful-Authentication"><a href="#Erasing-Credentials-on-Successful-Authentication" class="headerlink" title="Erasing Credentials on Successful Authentication"></a>Erasing Credentials on Successful Authentication</h5><p>默认情况下（从Spring Security 3.1开始），<code>ProviderManager</code>它将尝试从<code>Authentication</code>成功的身份验证请求返回的对象中清除所有敏感的凭据信息。这样可以防止将密码之类的信息保留的时间过长。</p>
<p>例如，在使用用户对象的缓存来提高无状态应用程序的性能时，这可能会导致问题。<br>如果<code>Authentication</code>包含对缓存中某个对象（例如<code>UserDetails</code>实例）的引用，并且已删除其凭据，则将无法再针对缓存的值进行身份验证.<br>如果使用缓存，则需要考虑到这一点。<br>一个明显的解决方案是先在高速缓存实现中,或在<code>AuthenticationProvider</code>创建返回<code>Authentication</code>的对象中,首先创建对象的副本。<br>或者，您可以在<code>ProviderManager</code>禁用该<code>eraseCredentialsAfterAuthentication</code>属性。</p>
<h5 id="DaoAuthenticationProvider"><a href="#DaoAuthenticationProvider" class="headerlink" title="DaoAuthenticationProvider"></a>DaoAuthenticationProvider</h5><p><code>Spring Security</code>中最简单的<code>AuthenticationProvider</code>实现方法是<code>DaoAuthenticationProvider</code>.也是框架最早支持的方法之一。<br>它利用<code>UserDetailsService</code>（作为DAO）查找用户名，密码和<code>GrantedAuthority</code><br>只需将比较<code>UsernamePasswordAuthenticationToken</code>提交的密码与<code>UserDetailsService</code>加载的密码，即可对用户进行身份验证</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;daoAuthenticationProvider&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;org.springframework.security.authentication.dao.DaoAuthenticationProvider&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDetailsService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;inMemoryDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;passwordEncoder&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;passwordEncoder&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;inMemoryDaoImpl&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">class</span>=<span class="string">&quot;org.springframework.security.provisioning.InMemoryUserDetailsManager&quot;</span> &gt;</span></span><br><span class="line">....</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>PasswordEncoder</code>是可选的。<code>PasswordEncoder</code>提供对<code>UserDetails</code>从配置的返回的对象中提供的密码进行编码和解码<code>UserDetailsService</code>。</p>
<h4 id="UserDetailsService-Implementations"><a href="#UserDetailsService-Implementations" class="headerlink" title="UserDetailsService Implementations"></a>UserDetailsService Implementations</h4><p>大多数身份验证提供程序都利用<code>UserDetails</code>和<code>UserDetailsService</code>接口.<code>UserDetailsService</code>只是一个简单的方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException</span>;</span><br></pre></td></tr></table></figure>
<p>返回的<code>UserDetails</code>是一个接口，该接口提供了获取器，该获取器保证以非空方式提供身份验证信息，例如用户名，密码，已授予的权限以及用户帐户是启用还是禁用。<br>大多数身份验证提供程序(providers)会使用<code>UserDetailsService</code>,即使用户名和密码实际上没有用作身份验证决策的一部分.<br>他们使用<code>UserDetailsService</code>作为返回,可能仅仅只是为了获取<code>GrantedAuthority</code>信息,因为某些其他系统（例如LDAP或X.509或CAS等）承担了实际验证凭据的责任。</p>
<p><code>UserDetailsService</code>可以很轻松的实现,因此用户应该使用自己选择的持久性策略轻松检索身份验证信息。<code>Spring Security</code>包含一些有用的基本实现.</p>
<h5 id="In-Memory-Authentication"><a href="#In-Memory-Authentication" class="headerlink" title="In-Memory Authentication"></a>In-Memory Authentication</h5><p>创建自定义<code>UserDetailsService</code>实现,从持久化引擎中提取用户信息很简单,但是许多应用程序不需要这种复杂性.<br>如果你正在构建原型或刚刚开始集成<code>Spring Security</code>,而又不花时间配置数据库或者自定义一个<code>UserDetailsService</code>实现,则可采用下列配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user-service</span> <span class="attr">id</span>=<span class="string">&quot;userDetailsService&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Password is prefixed with &#123;noop&#125; to indicate to DelegatingPasswordEncoder that</span></span><br><span class="line"><span class="comment">NoOpPasswordEncoder should be used. This is not safe for production, but makes reading</span></span><br><span class="line"><span class="comment">in samples easier. Normally passwords should be hashed using BCrypt --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;jimi&quot;</span> <span class="attr">password</span>=<span class="string">&quot;&#123;noop&#125;jimispassword&quot;</span> <span class="attr">authorities</span>=<span class="string">&quot;ROLE_USER, ROLE_ADMIN&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;bob&quot;</span> <span class="attr">password</span>=<span class="string">&quot;&#123;noop&#125;bobspassword&quot;</span> <span class="attr">authorities</span>=<span class="string">&quot;ROLE_USER&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user-service</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>也支持使用外部属性文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user-service</span> <span class="attr">id</span>=<span class="string">&quot;userDetailsService&quot;</span> <span class="attr">properties</span>=<span class="string">&quot;users.properties&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>属性文件应包含以下形式的条目</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username</span>=<span class="string">password,grantedAuthority[,grantedAuthority][,enabled|disabled]</span></span><br></pre></td></tr></table></figure>
<p>例如</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jimi</span>=<span class="string">jimispassword,ROLE_USER,ROLE_ADMIN,enabled</span></span><br><span class="line"><span class="attr">bob</span>=<span class="string">bobspassword,ROLE_USER,enabled</span></span><br></pre></td></tr></table></figure>

<h5 id="JdbcDaoImpl"><a href="#JdbcDaoImpl" class="headerlink" title="JdbcDaoImpl"></a>JdbcDaoImpl</h5><p><code>Spring Security</code>还包括一个<code>UserDetailsService</code>可从<code>JDBC</code>数据源获取身份验证信息的。<br>在内部使用<code>Spring JDBC</code>，因此它避免了仅用于存储用户详细信息的功能齐全的对象关系映射器（ORM）的复杂性。<br>如果您的应用程序确实使用了ORM工具，则您可能更愿意编写一个自定义<code>UserDetailsService</code>来重用您可能已经创建的映射文件。<br>返回<code>JdbcDaoImpl</code>，示例配置如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.hsqldb.jdbcDriver&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:hsqldb:hsql://localhost:9001&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sa&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDetailsService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;org.springframework.security.core.userdetails.jdbc.JdbcDaoImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>您可以通过修改<code>DriverManagerDataSource</code>上面显示的内容使用不同的关系数据库管理系统。<br>您还可以使用从JNDI获得的全局数据源，就像其他任何Spring配置一样。</p>
<h5 id="Authority-Groups"><a href="#Authority-Groups" class="headerlink" title="Authority Groups"></a>Authority Groups</h5><p>默认情况下，<code>JdbcDaoImpl</code>假设权限直接映射到用户，则为单个用户加载权限。<br>另一种方法是将权限划分为组，然后将组分配给用户。有些人喜欢使用这种方法来管理用户权限。</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/melodyfff">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Security-Architecture-and-Implementation-%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.</span> <span class="toc-text">Spring Security Architecture and Implementation(架构和实现)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Architecture-and-Implementation-%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.1.</span> <span class="toc-text">Architecture and Implementation(架构与实现)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary-%E6%91%98%E8%A6%81"><span class="toc-number">1.1.1.</span> <span class="toc-text">Summary(摘要)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Authentication-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">1.1.2.</span> <span class="toc-text">Authentication(身份验证)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#What-is-authentication-in-Spring-Security"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">What is authentication in Spring Security?</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Authentication-in-a-Web-Application"><span class="toc-number">1.1.3.</span> <span class="toc-text">Authentication in a Web Application</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ExceptionTranslationFilter"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">ExceptionTranslationFilter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AuthenticationEntryPoint"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">AuthenticationEntryPoint</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Authentication-Mechanism"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">Authentication Mechanism</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Storing-the-SecurityContext-between-requests"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">Storing the SecurityContext between requests</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Access-Control-Authorization-in-Spring-Security"><span class="toc-number">1.1.4.</span> <span class="toc-text">Access-Control (Authorization) in Spring Security</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Security-and-AOP-Advice"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">Security and AOP Advice</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Secure-Objects-and-the-AbstractSecurityInterceptor"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">Secure Objects and the AbstractSecurityInterceptor</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#What-are-Configuration-Attributes-%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">1.1.4.2.1.</span> <span class="toc-text">What are Configuration Attributes(配置属性)?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RunAsManager"><span class="toc-number">1.1.4.2.2.</span> <span class="toc-text">RunAsManager</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AfterInvocationManager"><span class="toc-number">1.1.4.2.3.</span> <span class="toc-text">AfterInvocationManager</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Extending-the-Secure-Object-Model"><span class="toc-number">1.1.4.2.4.</span> <span class="toc-text">Extending the Secure Object Model</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Core-Services-%E6%A0%B8%E5%BF%83%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.1.5.</span> <span class="toc-text">Core Services(核心服务)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AuthenticationManager%EF%BC%8CProviderManager%E5%92%8CAuthenticationProvider"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">AuthenticationManager，ProviderManager和AuthenticationProvider</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Erasing-Credentials-on-Successful-Authentication"><span class="toc-number">1.1.5.1.1.</span> <span class="toc-text">Erasing Credentials on Successful Authentication</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DaoAuthenticationProvider"><span class="toc-number">1.1.5.1.2.</span> <span class="toc-text">DaoAuthenticationProvider</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDetailsService-Implementations"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">UserDetailsService Implementations</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#In-Memory-Authentication"><span class="toc-number">1.1.5.2.1.</span> <span class="toc-text">In-Memory Authentication</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JdbcDaoImpl"><span class="toc-number">1.1.5.2.2.</span> <span class="toc-text">JdbcDaoImpl</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Authority-Groups"><span class="toc-number">1.1.5.2.3.</span> <span class="toc-text">Authority Groups</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&text=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&title=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&is_video=false&description=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=【Java】Spring Security Architecture and Implementation(架构和实现)&body=Check out this article: http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&title=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&title=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&title=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&title=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&name=【Java】Spring Security Architecture and Implementation(架构和实现)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2019/10/18/%E3%80%90Java%E3%80%91Spring%20Security%20Architecture%20and%20Implementation(%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%9E%E7%8E%B0)/&t=【Java】Spring Security Architecture and Implementation(架构和实现)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2015-2023
    Xin Chen
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/melodyfff">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
